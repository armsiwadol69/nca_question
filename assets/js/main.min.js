function handleScriptLoad(){return new Promise(e=>{var t=document.getElementById("loading-indicator");t.style.transition="opacity 0.5s",t.style.opacity="0",setTimeout(function(){t.style.display="none",e()},500)})}function fireSwalOnSubmit(){Swal.fire({imageUrl:"../assets/images/loading-37.webp",text:"กำลังบันทึกข้อมูล...",imageWidth:"77px",showConfirmButton:!1,showCloseButton:!1,showCancelButton:!1,backdrop:!0,allowOutsideClick:!1})}function checkCURD(){"1"==sessionStorage.getItem("curdStatus")?Swal.fire({icon:"success",text:"ดำเนินการสำเร็จ",timer:2e3,showConfirmButton:!1,showCloseButton:!1}):"0"==sessionStorage.getItem("curdStatus")&&Swal.fire({icon:"error",text:"ดำเนินการไม่สำเร็จ",timer:2e3,showConfirmButton:!1,showCloseButton:!1}),sessionStorage.removeItem("curdStatus")}async function fireSwalOnError(e,t){Swal.fire({icon:"error",title:"บันทึกข้อมูลไม่สำเร็จ",html:e,footer:t,showConfirmButton:!0})}function setDropdownRewardValue(e,t,n,a,r){document.getElementById("par_type").value=e,document.getElementById("par_category").value=t,document.getElementById("par_active").value=n,document.getElementById("par_redeemfeq").value=a,document.getElementById("par_ishot").value=r}function clickToLogout(){Swal.fire({title:"คุณต้องการที่จะออกจากระบบหรือไม่?",icon:"question",showCancelButton:!0,confirmButtonText:"ใช่",cancelButtonText:"ไม่",confirmButtonColor:"#FE0000"}).then(e=>{e.isConfirmed&&(window.location.href="../phpfunc/logout.php")})}function addslashes(e){return(e+"").replace(/[\\"']/g,"\\$&").replace(/\u0000/g,"\\0")}async function initRewardListTable(){rewardListTable=$("#rewardListTable").DataTable({stateSave:!1,aLengthMenu:aLengthMenu,iDisplayLength:25,ordering:!1,language:dataTableSettings,dom:tableDom,buttons:tableButton,columns:[{render:function(e,t,n,a){return a.row+a.settings._iDisplayStart+1}},{data:"giftdetail_image1",render:function(e,t,n,a){return`<img class="img-fluid" src="../storage/${n.giftdetail}/${e}"/>`}},{data:"giftdetail_name"},{data:"giftdetail_partnername"},{data:"giftdetail_type",render:function(e,t,n){return 1==e?'<i class="bi bi-ticket"></i> คูปอง':2==e?'<i class="bi bi-box2-heart"></i> สิ่งของ':3==e?'<i class="bi bi-ticket-perforated"></i> คูปอง (โค้ดเดียว)':e}},{data:"giftcategory_name"},{data:"giftdetail_point",render:function(e){return parseInt(e).toLocaleString("th-TH")+"pts."}},{data:"giftdetail_startdate",render:function(e,t,n){return dayjs(e,"YYYY-MM-DD").format("DD MMMM BBBB")+" ถึง "+dayjs(n.giftdetail_enddate,"YYYY-MM-DD").format("DD MMMM BBBB")}},{data:"giftdetail_redeemfeq",render:function(e){return"freely"==e?"ไม่จำกัด":"once"==e?"ครั้งเดียว":"weekly"==e?"รายสัปดาห์":"monthly"==e?"รายเดือน":"daily"==e?"รายวัน":e}},{data:"total_items",render:function(e,t,n){return"3"==n.giftdetail_type?"0"==n.total_items?'<p class="mt-2">'+n.giftdetail_quantity.toLocaleString("th-TH")+'<br><span class="badge text-bg-danger"><i class="bi bi-exclamation-triangle"></i> ยังไม่ได้เพิ่มสิทธิ์</span></p>':n.giftdetail_quantity.toLocaleString("th-TH"):parseInt(n.total_items)<parseInt(n.giftdetail_quantity)?'<p class="mt-2">'+e.toLocaleString("th-TH")+'<br><span class="badge text-bg-warning"><i class="bi bi-exclamation-triangle"></i> เพิ่มสิทธิ๋ไม่ครบ</span></p>':parseInt(n.total_items)>parseInt(n.giftdetail_quantity)?'<p class="mt-2">'+e.toLocaleString("th-TH")+'<br><span class="badge text-bg-warning"><i class="bi bi-exclamation-triangle"></i> จำนวนสิทธิ์มากกว่าทีตั้งไว้</span></p>':"0"==parseInt(n.total_items)?'<p class="mt-2">'+e.toLocaleString("th-TH")+'<br><span class="badge text-bg-danger"><i class="bi bi-exclamation-triangle"></i> ยังไม่ได้เพิ่มสิทธิ์</span></p>':e.toLocaleString("th-TH")}},{data:"items_used",render:function(e){return e.toLocaleString("th-TH")}},{data:"items_reserve",render:function(e){return e.toLocaleString("th-TH")}},{data:"giftdetail_active",render:function(e,t,n){return 1==e?'<h6><span class="badge text-bg-success mt-2"><i class="bi bi-check-circle"></i> เปิดให้แลก</span></h6>':0==e?'<h6><span class="badge text-bg-danger mt-2"><i class="bi bi-check-circle"></i> ปิดให้แลก</span></h6>':e}},{data:"giftdetail",render:function(e,t,n){return`\n                <div class="btn-group" role="group">\n                    <button type="button" class="btn btn-warning" onclick="callAction('${e}','edit','${n.giftdetail_gift}')"><i class="bi bi-pencil-square"></i> แก้ไข</button>\n                    <button type="button" class="btn btn-info" onclick="callAction('${e}','itemManagement','${n.giftdetail_gift}')"><i class="bi bi-list-task"></i> จัดการ</button>\n                    <button type="button" class="btn btn-danger" onclick="callAction('${e}','delete','${n.giftdetail_gift}')"><i class="bi bi-trash3"></i> ลบ</button>\n                </div>\n                 `}}]})}async function initItemListTable(){itemListTable=$("#itemListTalbe").DataTable({stateSave:!1,aLengthMenu:aLengthMenu,iDisplayLength:25,ordering:!1,order:[[0,"desc"]],columnDefs:[{targets:0,orderable:!1}],language:dataTableSettings,dom:tableDom,buttons:tableButton,serverSide:!0,processing:!0,ajax:{url:"../phpfunc/rewardapi.php?method=getItemList",type:"POST",data:function(e){e.offset=e.start,e.limit=e.length,e.par_id=par_id,e.giftType=par_giftType,e.search=e.search.value},dataSrc:function(e){var t=document.getElementById("item_total");if("3"!=e.giftitems_type){t.innerHTML=`${maximumItems} สิทธิ์`,document.getElementById("recordsTotalText").innerHTML=e.recordsTotal,document.getElementById("redeemedText").innerHTML=e.redeemed,document.getElementById("redeemableText").innerHTML=e.redeemable,document.getElementById("reserveText").innerHTML=e.reserve;var n=parseInt(e.recordsTotal)-maximumItems;document.getElementById("times").setAttribute("max",Math.abs(n)),document.getElementById("remainingImport").innerHTML="นำเข้าได้อีก : "+Math.abs(maximumItems-parseInt(e.recordsTotal))+" สิทธิ์",document.getElementById("par_maxInsertCSV").value=Math.abs(maximumItems-parseInt(e.recordsTotal))}else{t.innerHTML=`${maximumItems}`,document.getElementById("recordsTotalText").innerHTML=maximumItems,document.getElementById("redeemedText").innerHTML=e.redeemed,document.getElementById("redeemableText").innerHTML=maximumItems-parseInt(e.redeemed),document.getElementById("reserveText").innerHTML="N/A","0"==e.recordsTotal?document.getElementById("noCodeAlert").removeAttribute("hidden"):document.getElementById("noCodeAlert").setAttribute("hidden","");n=parseInt(e.recordsTotal);""!=e.data?(document.getElementById("times").setAttribute("max","0"),document.getElementById("insertBatchBtn").setAttribute("disabled",""),n=0):(document.getElementById("times").setAttribute("max","1"),document.getElementById("insertBatchBtn").removeAttribute("disabled"),n=1),document.getElementById("remainingImport").innerHTML="นำเข้าได้อีก : "+Math.abs(n)+" สิทธิ์",document.getElementById("par_maxInsertCSV").value=Math.abs(n)}return 0==n?(document.getElementById("message").innerHTML="จำนวนของของพรีเมี่ยม มีจำนวนสูงสุดแล้ว",document.getElementById("message2").innerHTML="จำนวนของของพรีเมี่ยม มีจำนวนสูงสุดแล้ว",document.getElementById("csvFileInput").setAttribute("disabled",""),document.getElementById("uploadButton").setAttribute("disabled",""),document.getElementById("insertBatchBtn").setAttribute("disabled",""),n=0):(document.getElementById("message").innerHTML="",document.getElementById("message2").innerHTML="",document.getElementById("csvFileInput").removeAttribute("disabled"),document.getElementById("uploadButton").removeAttribute("disabled"),document.getElementById("insertBatchBtn").removeAttribute("disabled")),document.getElementById("checkbox4selectall").checked=!1,e.data}},columns:[{data:"giftitems",render:function(e,t,n,a){return"1"==n.giftitems_isused?`<input class="form-check-input" type="checkbox" value="${e}" name="selectItemsData[]" id="ck_${e}" disabled>`:`<input class="form-check-input" type="checkbox" value="${e}" name="selectItemsData[]" id="ck_${e}">`}},{render:function(e,t,n,a){return a.row+a.settings._iDisplayStart+1}},{data:"giftitems_code",render:function(e){return""!=e?truncateHalfString(e)+"<br>"+e:e}},{data:"giftitems_expires",render:function(e,t,n){return dayjs(e,"YYYY-MM-DD").format("DD/MM/BBBB")}},{data:"giftitems_active",render:function(e){return 1==e?'<h6><span class="badge text-bg-success mt-2"><i class="bi bi-check-circle"></i> เปิดให้แลก</span></h6>':0==e?'<h6><span class="badge text-bg-danger mt-2"><i class="bi bi-x-circle"></i> ปิดให้แลก</span></h6>':void 0}},{data:"giftitems_isused",render:function(e){return 1==e?'<h6><span class="badge text-bg-dark mt-2"><i class="bi bi-check-circle"></i> Used</span></h6>':0==e?'<h6><span class="badge text-bg-secondary mt-2"><i class="bi bi-check-circle"></i> Not Used</span></h6>':3==e?'<h6><span class="badge text-bg-dark mt-2"><i class="bi bi-check2-all"></i> Multi Used</span></h6>':void 0}},{data:"giftitems_modidspm"},{data:"giftitems_moddatetime",render:function(e,t,n){return dayjs(e,"YYYY-MM-DD HH:mm:ss").format("HH:mm DD/MM/BBBB")}}]})}async function initGiftHistoryTalbe(){giftHistoryTalbe=$("#giftHistoryTalbe").DataTable({stateSave:!1,aLengthMenu:aLengthMenu,iDisplayLength:25,ordering:!1,order:[[0,"desc"]],columnDefs:[{targets:0,orderable:!1}],language:dataTableSettings,dom:tableDom,buttons:tableButton,serverSide:!0,processing:!0,ajax:{url:"../phpfunc/rewardapi.php?method=getGiftTransectionHistory",type:"POST",data:function(e){e.offset=e.start,e.limit=e.length,e.search=e.search.value},dataSrc:function(e){return console.log(e),e.data}},columns:[{render:function(e,t,n,a){return a.row+a.settings._iDisplayStart+1}},{data:"giftdetail_image1",render:function(e,t,n,a){return`<img class="img-fluid" src="../storage/${n.giftdetail}/${e}"/>`}},{data:"giftdetail_name",render:function(e,t,n,a){return n.giftdetail_partnername+" : "+e}},{data:"giftrecords_code",render:function(e){return""!=e?`<a href="#" class="fw-bold text-decoration-none point" onclick="window.location.href='v_withdraw.php?pickupCode=${e}'">`+e.slice(0,e.length-4)+"####<br>"+`(${e})</a>`:e}},{data:"giftrecords_type",render:function(e,t,n){return 1==e?'<i class="bi bi-ticket"></i> คูปอง':2==e?'<i class="bi bi-box2-heart"></i> สิ่งของ':3==e?'<i class="bi bi-ticket-perforated"></i> คูปอง (โค้ดเดียว)':e}},{data:"giftcategory_name"},{data:"giftrecords_user"},{data:"giftrecords_usernm"},{data:"giftrecords_point",render:function(e){return parseInt(e).toLocaleString("th-TH")+"pts."}},{data:"giftrecords_pickupdate",render:function(e){return dayjs(e,"YYYY-MM-DD").format("DD MMMM YYYY")}},{data:"giftrecords_pickupoutletnm"},{data:"giftrecords_iscomplete",render:function(e,t,n){if(1==e){if("2"==n.giftrecords_type)var a=`${n.giftrecords_modidsnm}<br>${dayjs(n.giftrecords_pickupdatetime,"YYYY-MM-DD HH:mm:ss").format("HH:mm DD/MM/BB")}`;else a="";return'<h6><span class="badge text-bg-success mt-2"><i class="bi bi-check-circle"></i> สำเร็จ</span></h6>'+`${a}`}if(0==e)return'<h6><span class="badge text-bg-warning mt-2"><i class="bi bi-box-seam"></i> รอรับของ</span></h6>'}},{data:"giftrecords_datemaker",render:function(e){return dayjs(e,"YYYY-MM-DD HH:mm:ss").format("HH:mm DD/MM/BBBB")}}]})}async function getRewardListDataFromAPI(){try{var e="../phpfunc/rewardapi.php?method=getRewardList";const n=await axios.get(e);console.log(n.data);var t=n.data;rewardListTable.clear(),rewardListTable.rows.add(t),rewardListTable.draw()}catch(e){console.log(e)}}async function getItemListDataFromAPI(e){}function callAction(e,t,n){"edit"==t?window.location.href=`v_editReward.php?id=${e}`:"itemManagement"==t?window.location.href=`v_itemList.php?id=${e}`:"delete"==t&&Swal.fire({title:"คุณต้องการที่จะลบรายการนี้หรือไม่?",text:`รายการ : ${e}`,icon:"question",showCancelButton:!0,confirmButtonText:"ใช่",cancelButtonText:"ไม่",confirmButtonColor:"#FE0000"}).then(t=>{t.isConfirmed&&(window.location.href=`../phpfunc/curd.php?method=delReward&par_id=${e}&par_giftId=${n}`)})}function isObject(e){const t=document.getElementById("div_datepicker");"1"==e?t.setAttribute("hidden","true"):"2"==e?t.removeAttribute("hidden"):t.setAttribute("hidden","true")}async function submitFromAddBatchItemes(){fireSwalOnSubmit(),event.preventDefault();document.getElementById("par_id").value;const e=document.getElementById("frm_batch"),t=new FormData(e),n={};t.forEach((e,t)=>{n[t]?(Array.isArray(n[t])||(n[t]=[n[t]]),n[t].push(e)):n[t]=e});var a="../phpfunc/rewardapi.php?method=insertItemsAsBatch";await axios.post(a,t).then(function(e){console.log(e),"1"==e.data.resCode?Swal.fire({icon:"success",text:"บันทึกข้อมูลสำเร็จ",timer:2e3,showConfirmButton:!1,showCloseButton:!1}).then(()=>{setTimeout(()=>{itemListTable.ajax.reload()},100)}):fireSwalOnError("ไม่สามารถเพิ่มข้อมูลได้",JSON.stringify(e.data))}).catch(function(e){console.log(e)});var r=document.getElementById("createAsBatchModal"),i=bootstrap.Modal.getInstance(r);i.hide()}async function importCodeByCSV(){fireSwalOnSubmit();const e=document.getElementById("csvFileInput"),t=e.files[0];var n=document.getElementById("par_id").value;const a=document.getElementById("par_type_csv").value,r=document.getElementById("par_userId").value,i=document.getElementById("par_usernm").value,o=document.getElementById("par_maxInsertCSV").value;if(t){const e=new FormData;e.append("csvFile",t),e.append("par_id",n),e.append("par_type",a),e.append("par_userId",r),e.append("par_usernm",i),e.append("par_maxInsertCSV",o),await axios.post("../phpfunc/rewardapi.php?method=importCodeByCSV",e,{headers:{"Content-Type":"multipart/form-data"}}).then(e=>{console.log(e.data),"1"==e.data.resCode?Swal.fire({icon:"success",text:"บันทึกข้อมูลสำเร็จ",timer:2e3,showConfirmButton:!1,showCloseButton:!1}).then(()=>{setTimeout(()=>{itemListTable.ajax.reload()},100)}):(fireSwalOnError("ไม่สามารถเพิ่มข้อมูลได้",JSON.stringify(e.data)),getItemListDataFromAPI(n))}).catch(e=>{console.error("Error:",e),fireSwalOnError("ไม่สามารถเพิ่มข้อมูลได้ (API ERROR)",e)})}else document.getElementById("message").textContent="No file selected.";var s=document.getElementById("importCSVModal"),c=bootstrap.Modal.getInstance(s);c.hide()}function renderRewardInfoTable(e,t){let n,a=document.getElementById(t),r=a.innerHTML;"type"==e?1==r?n='<i class="bi bi-ticket"></i> คูปอง':2==r?n='<i class="bi bi-box2-heart"></i> สิ่งของ':3==r&&(n='<i class="bi bi-ticket-perforated"></i> คูปอง (โค้ดเดียว)'):"feq"==e?"freely"==r?n="ไม่จำกัด":"once"==r?n="ครั้งเดียว":"weekly"==r?n="รายสัปดาห์":"monthly"==r?n="รายเดือน":"daily"==r&&(n="รายวัน"):"category"==e?1==r?n="ท่องเที่ยวเดินทาง":2==r?n="อาหารและเครื่องดื่ม":3==r?n="บันเทิง":4==r?n="ช็อปปิ้ง":5==r?n="นครชัยแอร์":6==r?n="ไลน์สติกเกอร์":7==r?n="โอนคะแนน":8==r?n="สุขภาพและความงาม":9==r&&(n="อื่นๆ"):"evnetDuration"==e?(ArrayDate=r.split(" - "),n=dayjs(ArrayDate[0],"YYYY-MM-DD").format("DD MMMM BBBB")+" - "+dayjs(ArrayDate[1],"YYYY-MM-DD").format("DD MMMM BBBB")):"rewardActive"==e&&(0==r?n='<span class="badge text-bg-danger"><i class="bi bi-x-circle"></i> ปิดให้แลก</span>':1==r&&(n='<span class="badge text-bg-success"><i class="bi bi-check-circle"></i> เปิดให้แลก</span>')),a.innerHTML=n}async function actionItemsAsBatch(e){let t=document.getElementsByName("selectItemsData[]"),n="";console.log(e);for(var a=0,r=t.length;a<r;a++)t[a].checked&&(n+=","+t[a].value);if(null==n||""==n)return n="",void fireAlertToast("ไม่มีรายการที่เลือก");n=n.substring(1),console.log(n);document.getElementById("par_id").value;var i=document.getElementById("par_userId").value,o=document.getElementById("par_usernm").value;if("del"==e)var s="คุณต้องการที่จะลบรายการเหล่านี้หรือไม่?",c="รายการที่ลบไม่สามารถกู้คืนมาได้",d="../phpfunc/rewardapi.php?method=deleteItemsAsBatch";else if("switch"==e)s="คุณต้องการที่เปลี่ยนแปลงรายการเหล่านี้หรือไม่?",c="รายการที่เปิดให้แลกจะเปลี่ยนเป็นปิดให้แลกและรายการที่ปิดให้แลกจะเปลี่ยนเป็นเปิดให้แลก (สลับสถานะ)",d="../phpfunc/rewardapi.php?method=switchActiveItemsAsBatch";Swal.fire({title:s,text:c,icon:"question",footer:n,showCancelButton:!0,confirmButtonText:"ใช่",cancelButtonText:"ไม่",confirmButtonColor:"#FE0000"}).then(async e=>{if(e.isConfirmed){fireSwalOnSubmit();const e=new FormData;e.append("target",n),e.append("par_userId",i),e.append("par_usernm",o),console.log(e),await axios.post(d,e,{headers:{"Content-Type":"multipart/form-data"}}).then(e=>{console.log(e),"1"==e.data.resCode?Swal.fire({icon:"success",text:"ดำเนินการสำเร็จ",timer:2e3,showConfirmButton:!1,showCloseButton:!1}).then(()=>{itemListTable.ajax.reload(),document.getElementById("checkbox4selectall").checked=!1,setTimeout(()=>{},100)}):(fireSwalOnError("ไม่สามารถดำเนินการได้",JSON.stringify(e.data)),itemListTable.ajax.reload(),document.getElementById("checkbox4selectall").checked=!1)}).catch(e=>{console.error("Error:",e),fireSwalOnError("ไม่สามารถดำเนินการได้ (API ERROR)",e),itemListTable.ajax.reload(),document.getElementById("checkbox4selectall").checked=!1})}})}function toggleSelectAll(e){checkboxes=document.getElementsByName("selectItemsData[]");for(var t=0,n=checkboxes.length;t<n;t++)checkboxes[t].checked?checkboxes[t].checked=!1:checkboxes[t].checked=!0}async function fireAlertToast(e){Swal.fire({icon:"info",title:"แจ้งเตือน",html:e,toast:!0,timer:1500,timerProgressBar:!0,position:"center",showConfirmButton:!1})}function initSiwper(){var e=new Swiper(".mySwiper",{loop:!0,autoHeight:!0,spaceBetween:0,slidesPerView:5,freeMode:!0,watchSlidesProgress:!0});new Swiper(".mySwiper2",{loop:!0,autoHeight:!0,spaceBetween:0,navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"},thumbs:{swiper:e}})}async function callDeleteImage(e,t,n){if(null==n||""==n)return void alert(`รูปลำดับที่ ${t} ไม่ได้ถูกอัปโหลดไว้`);let a="../phpfunc/rewardapi.php?method=deleteImage";Swal.fire({title:"คุณต้องการที่จะรูปภาพหรือไม่?",text:`รูปภาพที่ : ${t}`,icon:"question",showCancelButton:!0,confirmButtonText:"ใช่",cancelButtonText:"ไม่",confirmButtonColor:"#FE0000"}).then(async r=>{if(r.isConfirmed){fireSwalOnSubmit();const r=new FormData;r.append("par_id",e),r.append("par_imageOrder",t),r.append("par_imageName",n),console.log(r),await axios.post(a,r,{headers:{"Content-Type":"multipart/form-data"}}).then(e=>{console.log(e),"1"==e.data.resCode?Swal.fire({icon:"success",text:"ดำเนินการสำเร็จ",timer:2e3,showConfirmButton:!1,showCloseButton:!1}).then(()=>{window.location.reload()}):fireSwalOnError("ไม่สามารถดำเนินการได้",JSON.stringify(e.data))}).catch(e=>{console.error("Error:",e),fireSwalOnError("ไม่สามารถดำเนินการได้ (API ERROR)",e)})}})}function truncateHalfString(e){const t="#",n=Math.floor(e.length/2),a=e.substring(0,n),r=t.repeat(n),i=a+r;return i}function checkFileSizeAndExtension(e){const t=document.getElementById(e),n=t.files[0];if(n){if(!isAllowedFile(n))return userInputNotValid("รูปแบบไฟล์รูปภาพไม่ถูกต้อง (รองรับ .jpg, .jpng, .png & .webp)"),void removeFileFromInput(e);if(!isValidFile(n,1048576))return userInputNotValid("ขนาดของไฟล์รูปใหญ่เกินไป (ไม่เกิน 1 MB)"),void removeFileFromInput(e)}}function isAllowedFile(e){const t=[".jpg",".jpeg",".png",".webp"],n=e.name.slice(2+(e.name.lastIndexOf(".")-1>>>0));return t.includes("."+n)}function isValidFile(e,t){return console.log("file.size : "+e.size),e.size<=t}function userInputNotValid(e){Swal.fire({html:e,icon:"error",toast:!0,position:"center",timer:3e3,timerProgressBar:!0,showConfirmButton:!1,didOpen:e=>{e.addEventListener("mouseenter",Swal.stopTimer),e.addEventListener("mouseleave",Swal.resumeTimer)}})}function removeFileFromInput(e){document.getElementById(e).value=""}async function getPickUpDetail(){fireSwalOnSubmit();var e=document.getElementById("pickupCode").value;console.log(e);try{var t=`../phpfunc/rewardapi.php?method=getPickUpDetail&pickupCode=${e}`;console.log(t);const a=await axios.get(t);console.log(a);var n=a.data;if(console.log(n),"99"==n.resCode)return fireSwal("info","ไม่พบข้อมูล","ไม่พบข้อมูลที่ตรงกับรหัสที่คุณกรอก"),html='<div class="alert alert-info text-center align-self-center fw-bold" role="alert">ไม่พบข้อมูล</div>',document.getElementById("pickupDetail").innerHTML=html,void document.getElementById("pickupConfrimBtn").setAttribute("hidden","");renderPickupDetail(n.data[0])}catch(e){fireSwal("error","พบข้อผิดพลาด",e)}}async function fireSwal(e,t,n){Swal.fire({icon:e,title:t,html:n,showConfirmButton:!0})}function renderPickupDetail(e){document.getElementById("par_pickupCode").value=e.giftrecords_code;const t=`\n  <table class="table shadow-sm table-striped table-bordered reward-info-table" id="pickupDetailTable">\n    <tr>\n        <td>รหัสรับของ : </td>\n        <td class="fw-bold">${e.giftrecords_code}</td>\n    </tr>\n    <tr>\n        <td>ชื่อผู้รับ : </td>\n        <td>${e.giftrecords_usernm}</td>\n    </tr>\n    <tr>\n        <td>สาขาที่รับ : </td>\n        <td>${e.giftrecords_pickupoutletnm}</td>\n    </tr>\n    <tr>\n        <td>วันที่กำหนดรับ : </td>\n        <td>${dayjs(e.giftrecords_pickupdate,"YYYY-MM-DD").format("DD MMMM BBBB")}</td>\n    </tr>\n    <tr>\n        <td>ชื่อของพรีเมี่ยม : </td>\n        <td>${e.giftdetail_name}</td>\n    </tr>\n    <tr>\n        <td>พาร์ทเนอร์ : </td>\n        <td>${e.giftdetail_partnername}</td>\n    </tr>\n    <tr>\n        <td>ประเภท : </td>\n        <td>${renderType(e.giftrecords_type)}</td>\n    </tr>\n    <tr>\n        <td>หมวดหมู่ : </td>\n        <td>${e.giftcategory_name}</td>\n    </tr>\n    <tr>\n        <td>สถานะ : </td>\n        <td>${renderPickupStatus(e.giftrecords_iscomplete)}</td>\n    </tr>\n    <tr>\n        <td>ดำเนินการโดย : </td>\n        <td>${checkNullOrEmpty(e.giftrecords_modidsnm)}</td>\n    </tr>\n    <tr>\n        <td>ดำเนินการเมื่อ : </td>\n        <td>${checkNullOrEmpty(e.giftrecords_pickupdatetime)}</td>\n    </tr>\n</table>\n<hr>`;document.getElementById("pickupDetail").innerHTML=t;const n=document.getElementById("pickupConfrimBtn");"0"==e.giftrecords_iscomplete?n.removeAttribute("hidden"):n.setAttribute("hidden",""),Swal.close()}function renderCategory(e){return 1==e?"ท่องเที่ยวเดินทาง":2==e?"อาหารและเครื่องดื่ม":3==e?"บันเทิง":4==e?"ช็อปปิ้ง":5==e?"นครชัยแอร์":6==e?"ไลน์สติกเกอร์":7==e?"โอนคะแนน":8==e?"สุขภาพและความงาม":9==e?"อื่นๆ":e}function renderType(e){return 1==e?'<i class="bi bi-ticket"></i> คูปอง':2==e?'<i class="bi bi-box2-heart"></i> สิ่งของ':3==e?'<i class="bi bi-ticket-perforated"></i> คูปอง (โค้ดเดียว)':e}function renderPickupStatus(e){return 1==e?'<h3><span class="badge text-bg-success mt-2"><i class="bi bi-check-circle"></i> สำเร็จ</span></h3>':0==e?'<h3><span class="badge text-bg-warning mt-2"><i class="bi bi-box-seam"></i> รอรับของ</span></h3>':void 0}function validPickupCycel(){console.log("validPickupCycel");const e=document.getElementById("frm");document.getElementById("par_type").value,document.getElementById("par_pickupcycel").value;event.preventDefault(),e.submit()}async function userRecriveGift(){const e=document.getElementById("frm"),t=new FormData(e),n={};t.forEach((e,t)=>{n[t]?(Array.isArray(n[t])||(n[t]=[n[t]]),n[t].push(e)):n[t]=e}),console.log(n),await axios.post("../phpfunc/rewardapi.php?method=pickupGift",t).then(function(e){console.log(e),"1"==e.data.resCode?Swal.fire({icon:"success",text:"บันทึกข้อมูลสำเร็จ",timer:2e3,showConfirmButton:!1,showCloseButton:!1}).then(()=>{getPickUpDetail()}):fireSwalOnError("ไม่สามารถเพิ่มข้อมูลได้",JSON.stringify(e.data))}).catch(function(e){console.log(e)})}function checkNullOrEmpty(e){return""==e||null==e?"N/A":e}function setMinDate(){const e=document.getElementById("par_startdate").value;document.getElementById("par_enddate").min=e}function checkIsItemsExistReadOnly(e,t){let n=document.getElementById("par_quantity"),a=document.getElementById("par_quantityHelp"),r=document.getElementById("par_type"),i=document.getElementById("par_typeHelp");"0"!=t?(n.setAttribute("readonly",""),a.innerHTML="รายการนี้มีการแลกสิทธิ์แล้ว",r.classList.add("pe-none"),r.setAttribute("style","background-color:#e9ecef;"),i.innerHTML="รายการนี้มีการแลกสิทธิ์แล้ว"):"0"!=e&&(n.setAttribute("readonly",""),a.innerHTML="รายการนี้มีการเพิ่มสิทธ์แล้ว หากต้องการแก้ไขให้ลบสิทธิ์ที่มีอยู่ก่อน",r.classList.add("pe-none"),r.setAttribute("style","background-color:#e9ecef;"),i.innerHTML="รายการนี้มีการเพิ่มสิทธ์แล้ว หากต้องการแก้ไขให้ลบสิทธิ์ที่มีอยู่ก่อน")}function initCategoryTalbe(){categoryTalbe=$("#giftHistoryTalbe").DataTable({stateSave:!1,aLengthMenu:aLengthMenu,iDisplayLength:10,ordering:!1,order:[[0,"desc"]],columnDefs:[{targets:0,orderable:!1}],language:dataTableSettings,dom:tableDom,buttons:tableButton,buttons:[],serverSide:!0,processing:!0,ajax:{url:"../phpfunc/rewardapi.php",type:"POST",data:function(e){e.method="getCategoryData",e.offset=e.start,e.limit=e.length,e.search=e.search.value},dataSrc:function(e){return categoryData=e.data,e.data}},columns:[{render:function(e,t,n,a){return a.row+a.settings._iDisplayStart+1}},{data:"giftcategory_icon",render:function(e,t,n,a){return`<span style="font-size: 2rem;">${e}</span>`}},{data:"giftcategory_name"},{data:"giftcategory_active",render:function(e,t,n){return 1==e?'<h6><span class="badge text-bg-success mt-2"><i class="bi bi-eye"></i> แสดง</span></h6>':0==e?'<h6><span class="badge text-bg-danger mt-2"><i class="bi bi-eye-slash"></i> ซ่อน</span></h6>':e}},{data:"giftcategory_modidspnm",render:function(e,t,n,a){return`${e} <br> ${dayjs(n.giftcategory_moddatetime,"YYYY-MM-DD HH:mm:ss").format("HH:mm D/MM/BB")}`}},{data:"giftcategory",render:function(e,t,n){let a,r=addslashes(n.giftcategory_name);return a="1"==n.toatlItems?"disabled":"",`\n                <div class="btn-group" role="group">\n                    <button type="button" class="btn btn-warning" onclick="actionCategory('${e}','edit','${r}')"><i class="bi bi-pencil-square"></i> แก้ไข</button>\n                    <button type="button" class="btn btn-info" onclick="actionCategory('${e}','switch','${r}')"><i class="bi bi-arrow-repeat"></i> ซ่อน/แสดง</button>\n                    <button type="button" class="btn btn-danger ${a}" onclick="actionCategory('${e}','delete','${r}')"><i class="bi bi-trash3"></i> ลบ</button>\n                </div>\n                 `}}]})}function actionCategory(e,t,n){const a="../phpfunc/rewardapi.php";if("edit"==t)editCategory(e);else if("delete"==t)Swal.fire({title:"คุณต้องการที่จะลบรายการนี้หรือไม่?",text:`รายการ : ${n}`,icon:"question",showCancelButton:!0,confirmButtonText:"ใช่",cancelButtonText:"ไม่",confirmButtonColor:"#FE0000"}).then(async t=>{if(t.isConfirmed){fireSwalOnSubmit();const t=new FormData;t.append("method","delCategory"),t.append("target",e),console.log(t),await axios.post(a,t,{headers:{"Content-Type":"multipart/form-data"}}).then(e=>{console.log(e),"1"==e.data.resCode?Swal.fire({icon:"success",text:"ดำเนินการสำเร็จ",timer:2e3,showConfirmButton:!1,showCloseButton:!1}).then(()=>{categoryTalbe.ajax.reload()}):(fireSwalOnError("ไม่สามารถดำเนินการได้",JSON.stringify(e.data)),categoryTalbe.ajax.reload())}).catch(e=>{console.error("Error:",e),fireSwalOnError("ไม่สามารถดำเนินการได้ (API ERROR)",e),categoryTalbe.ajax.reload()})}});else if(t="switch"){var r="คุณต้องการที่เปลี่ยนแปลงรายการนี้หรือไม่?",i=`ซ่อน/แสดง : ${n}`;Swal.fire({title:r,text:i,icon:"question",showCancelButton:!0,confirmButtonText:"ใช่",cancelButtonText:"ไม่",confirmButtonColor:"#FE0000"}).then(async t=>{if(t.isConfirmed){fireSwalOnSubmit();const t=new FormData;t.append("method","switchCategoryActive"),t.append("target",e),t.append("par_userId",document.getElementById("par_userId").value),t.append("par_usernm",document.getElementById("par_usernm").value),console.log(t),await axios.post(a,t,{headers:{"Content-Type":"multipart/form-data"}}).then(e=>{console.log(e),"1"==e.data.resCode?Swal.fire({icon:"success",text:"ดำเนินการสำเร็จ",timer:2e3,showConfirmButton:!1,showCloseButton:!1}).then(()=>{categoryTalbe.ajax.reload()}):(fireSwalOnError("ไม่สามารถดำเนินการได้",JSON.stringify(e.data)),categoryTalbe.ajax.reload())}).catch(e=>{console.error("Error:",e),fireSwalOnError("ไม่สามารถดำเนินการได้ (API ERROR)",e),categoryTalbe.ajax.reload()})}})}}async function submitCategory(){event.preventDefault();const e=document.getElementById("frm_category"),t=new FormData(e);var n="../phpfunc/rewardapi.php";await axios.post(n,t).then(function(e){console.log(e),"1"==e.data.resCode?Swal.fire({icon:"success",text:"บันทึกข้อมูลสำเร็จ",timer:2e3,showConfirmButton:!1,showCloseButton:!1}).then(()=>{categoryTalbe.ajax.reload()}):fireSwalOnError("ไม่สามารถเพิ่มข้อมูลได้",JSON.stringify(e.data))}).catch(function(e){console.log(e)});const a=document.getElementById("createNewCategory"),r=bootstrap.Modal.getInstance(a);r.hide()}function editCategory(e){console.log(`id: ${e}`);const t=categoryData.find(t=>t.giftcategory==e);console.log(t),document.getElementById("edit_target").value=t.giftcategory,document.getElementById("edit_categoryName").value=t.giftcategory_name,document.getElementById("edit_icon").value=t.giftcategory_icon,document.getElementById("edit_caregoryActive").value=t.giftcategory_active;let n=bootstrap.Modal.getOrCreateInstance(document.getElementById("editCategory"));n.show()}async function submitEditCategoey(){const e=document.getElementById("frm_categoryEdit"),t=new FormData(e),n={};t.forEach((e,t)=>{n[t]?(Array.isArray(n[t])||(n[t]=[n[t]]),n[t].push(e)):n[t]=e}),console.log(n);var a="../phpfunc/rewardapi.php";await axios.post(a,t).then(function(e){console.log(e),"1"==e.data.resCode?Swal.fire({icon:"success",text:"บันทึกข้อมูลสำเร็จ",timer:2e3,showConfirmButton:!1,showCloseButton:!1}).then(()=>{categoryTalbe.ajax.reload()}):(fireSwalOnError("ไม่สามารถเพิ่มข้อมูลได้",JSON.stringify(e.data)),categoryTalbe.ajax.reload())}).catch(function(e){console.log(e),categoryTalbe.ajax.reload()});var r=document.getElementById("editCategory"),i=bootstrap.Modal.getInstance(r);i.hide()}$(function(){checkCURD()});var dataTableSettings={emptyTable:"ไม่มีรายการที่ถูกเพิ่มไว้",info:"รายการที่ _START_ ถึง _END_ จาก _TOTAL_ รายการ",lengthMenu:"แสดง _MENU_ รายการ",infoEmpty:"ไม่มีข้อมูล",loadingRecords:"โปรดรอซักครู่ กำลังเรียกขอมูล...",infoFiltered:"ค้นหาจาก _MAX_ รายการ",search:"ค้นหา :",paginate:{first:"หน้าแรก",last:"หน้าสุดท้าย",next:"ถัดไป",previous:"ก่อนหน้า"}};let rewardListTable,itemListTable,categoryTalbe,categoryData,tableDom="<'row mb-2'<'col-12'B>><'row'<'col-6'l><'col-6'f>><'row'<'col-12't>><'row'<'col-6'i><'col-6'p>><'clear'>",tableButton=["copy","excel","print"],aLengthMenu=[[5,10,25,50,100,250,500,1e3],[5,10,25,50,100,250,500,1e3]];$(".show_confirm").click(function(e){var t=$(this).closest("form");$(this).data("name");e.preventDefault(),swal.fire({title:"ยืนยันการส่งมอบ",text:"ยืนยันการส่งมอบหรือไม่?",icon:"info",showCloseButton:!1,showCancelButton:!0,confirmButtonColor:"#009c6b",confirmButtonText:"ใช่",cancelButtonText:"ไม่"}).then(e=>{e.isConfirmed&&t.submit()})});